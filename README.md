# PriceTierView
查询电子元器件价格步骤：
 - URL:https://www.oneyac.com/category/1207.html
 - 每次请求发现URL都不同，最终发现URL组成格式：/search?callback=jQuery + 数字 + 请求数据
    - 请求数据包含：
        - 回调函数callback （callback=jQuery1124032359969327551297_1589472065817）
            - 通过百度搜索URL带jQuery 可知jQuery后面回调函数，数字为函数名（随机生成,libs-all.min-119aef9b16fe132c812e6ef89ac7e9dc.js可查找到源代码）
                - js源代码：'jQuery' + (m + Math.random()).replace(/\D/g, '')，通过查找关键字m，可知 m = '1.12.4'
                - 通过浏览器开发工具调试控制台可知，Math.random()生成0~1的随机浮点数（精度小数点后17位），.replace(/\D/g, '') 表示用‘’替换‘.’
            - _ 后的数字与URL最后一个参数数字相近
        - paramsDTO ： 参数字典
            - 规格参数数组，可以参考网页源代码中LIST_FORM或者多次请求发现规格的字典的变化
            - token ： 令牌
            - xlsToken ： 令牌
                - 查看js源文件可以发现，token由getSearchToken 函数生成
                - 图片一地址
                - data.token : 在网页源代码中可以通过‘token’查询到
                - data.xlsToken ： 在网页源代码中可以通过‘xlsToken’查询到
                - data.requestParameters.supplierId ： 默认为1
                - getSearchToken 全局搜索无法找到相关函数定义，可以通过使用火狐浏览器的调试功能在代码前设置断点，然后点击进入可以查询到源代码，js代码采用加密
                - 图片2，3
                - 解密搜索引擎搜索，发现https://www.sojson.com/question/69720496242191535293.html，由讲解，有专门的人进行解密工作，需要付费，添加微信，将加密源文件发给解密工作人员，最终得到解密js代码
                - 将js代码转换成python代码,这里使用execjs 库进行快速导入js文件执行代码：https://www.jianshu.com/p/df4ae2374a68
        - _ : 多次使用浏览器模拟，发现前面几位始终不变，仅最后两位有变化，猜测与时间有关，查找相关视频最终确认为时间浮点数
 - VB调用Python
 - 教程：https://www.jianshu.com/p/e60f8e057cba
 - 环境准备工作
    - python3.7安装pywin32模块：https://www.cnblogs.com/fcc-123/p/12002354.html
    - Windows管理员权限运行Python代码（编写cmd）：https://blog.csdn.net/MemoryD/article/details/83148305
 - 代码编写注意事项：
    - 注册COM（注册一次后，永久有效，Python中可随时更改代码，不用重新注册，如需删除com，管理员模式运行命令：python py_name.py --unregister）
        - _public_methods_=['VbgetPrice']   指定对外可调用函数为VbgetPrice
        - _reg_progid_='PythonDemos.Utilities'  指定vba调用com接口名称，vba中只能通过CreateObject("PythonDemos.Utilities")连接此com口
        - _reg_clsid_=pythoncom.CreateGuid()    获取本机注册码并赋值，注意每次运行注册码都不一样
    - 定义类
        - 自定义被调函数（对象）形参第一个通常为self，其他自定义形参需要进入函数后第一步声明变量类型，否则vba会调用报错（自动化失败）
        - 函数返回值不能是字典，目前已知可返回数据类型为字符串
        - 保持网络畅通，否则容易爬取失败，不能返回有效值，各种错误有待完善
 
